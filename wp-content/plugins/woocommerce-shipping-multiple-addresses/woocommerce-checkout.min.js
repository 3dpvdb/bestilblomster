var last_id="",_multi_shipping=!1;jQuery(document).ready(function(e){e("select.shipping_methods").live("change",function(){e("body").trigger("update_checkout")});e("[name=shipping_method]").live("change",function(){e(this).val()=="local_pickup"||e(this).val()=="local_pickup_plus"?e("#wcms_message").hide():e("#wcms_message").show()}).change();e("body").bind("updated_checkout",function(){_multi_shipping&&e("tr.shipping").remove()});e(".user-add-address").click(function(t){t.preventDefault();var n="",r=e("#address_form_template").html();do{n=Math.floor(Math.random()*99999999)+1;r=r.replace(/(\|sig\|)/gi,n)}while(e("#shipping_address_"+n).length>=1);tb_show("New Address","#TB_inline?height=450&width=400&inlineId=address_form_template&sig="+n)});e(".add-address").click(function(t){t.preventDefault();var n="",r=e("#address_form_template").html();do{n=Math.floor(Math.random()*99999999)+1;e("#address_id").val(n)}while(e("#shipping_address_"+n).length>=1);tb_show("New Address","#TB_inline?height=450&width=400&inlineId=address_form_template&sig="+n)});e(".user-duplicate-cart").click(function(e){e.preventDefault();tb_show("Shipping Address","#TB_inline?height=350&width=550&inlineId=duplicate_address_form_template")});e("#add_address_form").submit(function(){var t=e(this).serialize()+"&action=wc_save_to_address_book";e.post(WCMS.ajaxurl,t,function(t){var n=e.parseJSON(t);if(n.ack=="OK"){tb_remove();var r=n.id,i=n.html;e("#addresses_container").prepend(i);e("#items_column_"+r).droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(t,n){var r=e(n.draggable).data("quantity"),i=1;if(r>1){i=prompt("Enter the quantity (1-"+r+"):","1");if(i==null)return!1;i<1&&(i=1);i=Math.floor(i);i>r&&(i=r)}e(this).find(".placeholder").remove();r-=i;var s=e(n.draggable).attr("id"),o=e(n.draggable).data("product-id"),u=e(".address-item-key-"+s,this).length,a=e(this).attr("id").split("_")[2];e(n.draggable).data("quantity",r);e(".qty",n.draggable).text(r);if(u==0){var f=e(n.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),l=e("<li></li>").attr("class",f).addClass("address-item-key-"+s).data("key",s).data("product-id",o).html(n.draggable.html()).appendTo(this);for(var c=0;c<i;c++)e(l).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />');e(l).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/delete.png" title="Remove" /></a>').find(".qty").text(i);e(l).find("div.quantity").remove()}else{var h=parseInt(e(".address-item-key-"+s,this).find(".qty").text());e(".address-item-key-"+s,this).find(".qty").text(h+i);for(var c=0;c<i;c++)e(".address-item-key-"+s,this).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />')}r==0&&e(n.draggable).remove()}});e("#addresses_container").masonry("reload")}else n.ack=="ERR"&&alert(n.message)});return!1});e("#duplicate_cart_form").submit(function(){var t=e(this).serialize()+"&action=wc_duplicate_cart";e.post(WCMS.ajaxurl,t,function(t){var n=e.parseJSON(t);if(n.ack=="OK"){tb_remove();var r=n.id,i=n.html;e("#addresses_container").prepend(i);e("#items_column_"+r).droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(t,n){var r=e(n.draggable).data("quantity"),i=1;if(r>1){i=prompt("Enter the quantity (1-"+r+"):","1");if(i==null)return!1;i<1&&(i=1);i=Math.floor(i);i>r&&(i=r)}e(this).find(".placeholder").remove();r-=i;var s=e(n.draggable).attr("id"),o=e(n.draggable).data("product-id"),u=e(".address-item-key-"+s,this).length,a=e(this).attr("id").split("_")[2];e(n.draggable).data("quantity",r);e(".qty",n.draggable).text(r);if(u==0){var f=e(n.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),l=e("<li></li>").attr("class",f).addClass("address-item-key-"+s).data("key",s).data("product-id",o).html(n.draggable.html()).appendTo(this);for(var c=0;c<i;c++)e(l).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />');e(l).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/delete.png" title="Remove" /></a>').find(".qty").text(i);e(l).find("div.quantity").remove()}else{var h=parseInt(e(".address-item-key-"+s,this).find(".qty").text());e(".address-item-key-"+s,this).find(".qty").text(h+i);for(var c=0;c<i;c++)e(".address-item-key-"+s,this).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />')}r==0&&e(n.draggable).remove()}});e("#addresses_container").masonry("reload")}else n.ack=="ERR"&&alert(n.message)});return!1});e(".address-use").click(function(){var t=e.parseJSON(e(this).parents("p").prev("textarea").val());e(this).prop("disabled",!0);e(".add-address").click();setAddress(t,last_id)});e("#cart_items ul li").draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:0,top:0}});e("li.address-item > a.remove").live("click",function(t){t.preventDefault();var n=e(this).parents("li.address-item"),r=e(n).parents(".items-column"),i=parseInt(e(n).find(".qty").text()),s=e(n).data("key"),o=e(n).data("product-id");if(e("#"+s).length>0){var u=parseInt(e("#"+s).find(".qty").text()),a=u+i;e("#"+s).data("quantity",a).find(".qty").text(a)}else{var f=e("<li></li>").html(e(n).html()).data("quantity",i).data("product-id",o).attr("class",e(n).attr("class").replace(/(address\-item)/gi,"cart-item")).attr("id",e(n).data("key"));e(f).find("a.remove").remove();e(f).find("input").remove();e(f).appendTo("ul.cart-items");e(f).draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:0,top:0}})}e(n).remove();e(r).children("li").length==0&&e(r).append('<li class="placeholder">Drag items here</li>');e("#addresses_container").masonry("reload")});e("#address_form").submit(function(){if(e(".cart-items li").length>0){alert("Please assign a shipping address for all your cart items.");return!1}});e(".items-column").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(t,n){var r=e(n.draggable).data("quantity"),i=1;if(r>1){i=prompt("Enter the quantity (1-"+r+"):","1");if(i==null)return!1;i<1&&(i=1);i=Math.floor(i);i>r&&(i=r)}e(this).find(".placeholder").remove();r-=i;var s=e(n.draggable).attr("id"),o=e(n.draggable).data("product-id"),u=e(".address-item-key-"+s,this).length,a=e(this).attr("id").split("_")[2];e(n.draggable).data("quantity",r);e(".qty",n.draggable).text(r);if(u==0){var f=e(n.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),l=e("<li></li>").attr("class",f).addClass("address-item-key-"+s).data("key",s).data("product-id",o).html(n.draggable.html()).appendTo(this);for(var c=0;c<i;c++)e(l).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />');e(l).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/delete.png" title="Remove" /></a>').find(".qty").text(i);e(l).find("div.quantity").remove()}else{var h=parseInt(e(".address-item-key-"+s,this).find(".qty").text());e(".address-item-key-"+s,this).find(".qty").text(h+i);for(var c=0;c<i;c++)e(".address-item-key-"+s,this).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />')}r==0&&e(n.draggable).remove();jQuery("#addresses_container").masonry("reload")}});var t=woocommerce_params.countries.replace(/&quot;/g,'"'),n=jQuery.parseJSON(t);jQuery("select.country_to_state").live("change",function(){var t=e(this).val(),r=e(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]'),i=r.parent(),s=r.attr("name"),o=r.attr("id"),u=r.val();if(n[t])n[t].length==0?i.fadeOut(200,function(){r.parent().find(".chzn-container").remove();r.replaceWith('<input type="hidden" class="hidden" name="'+s+'" id="'+o+'" value="" />');e("body").trigger("country_to_state_changed",[t,e(this).closest("div")])}):i.fadeOut(200,function(){var a="",f=n[t];for(var l in f)a=a+'<option value="'+l+'">'+f[l]+"</option>";if(r.is("input")){r.replaceWith('<select name="'+s+'" id="'+o+'" class="state_select"></select>');r=e(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]')}r.html('<option value="">'+woocommerce_params.select_state_text+"</option>"+a);r.val(u);e("body").trigger("country_to_state_changed",[t,e(this).closest("div")]);i.fadeIn(500)});else if(r.is("select"))i.fadeOut(200,function(){i.find(".chzn-container").remove();r.replaceWith('<input type="text" class="input-text" name="'+s+'" id="'+o+'" />');e("body").trigger("country_to_state_changed",[t,e(this).closest("div")]);i.fadeIn(500)});else if(r.is(".hidden")){i.find(".chzn-container").remove();r.replaceWith('<input type="text" class="input-text" name="'+s+'" id="'+o+'" />');e("body").trigger("country_to_state_changed",[t,e(this).closest("div")]);i.delay(200).fadeIn(500)}e("body").delay(200).trigger("country_to_state_changing",[t,e(this).closest("div")])}).change();e("#addresses_container").masonry({itemSelector:".account-address",isFitWidth:!0});if(Modernizr&&Modernizr.touch){e("li.cart-item").click(function(){if(e(this).hasClass("cart-item-active")){e(this).removeClass("cart-item-active");e("#addresses_container .account-address").removeClass("drop-ready")}else{e(this).addClass("cart-item-active");e("#addresses_container .account-address").addClass("drop-ready")}});e(".drop-ready .items-column").live("click",function(){var t=this;e("li.cart-item-active").each(function(){var n=this,r=e(n).data("quantity"),i=1;e(t).find(".placeholder").remove();r-=i;var s=e(n).attr("id"),o=e(n).data("product-id"),u=e(".address-item-key-"+s,t).length,a=e(t).attr("id").split("_")[2];e(n).data("quantity",r);e(".qty",n).text(r);if(u==0){var f=e(n).attr("class").replace(/(cart\-item)/gi,"address-item"),l=e("<li></li>").attr("class",f).addClass("address-item-key-"+s).data("key",s).data("product-id",o).html(e(n).html());e(t).append(l);for(var c=0;c<i;c++)e(l).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />');e(l).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/delete.png" title="Remove" /></a>').find(".qty").text(i);e(l).find("div.quantity").remove()}else{var h=parseInt(e(".address-item-key-"+s,t).find(".qty").text());e(".address-item-key-"+s,t).find(".qty").text(h+i);for(var c=0;c<i;c++)e(".address-item-key-"+s,t).append('<input type="hidden" name="items_'+a+'[]" value="'+s+'" />')}r==0&&e(n).remove();jQuery("#addresses_container").masonry("reload")})})}});